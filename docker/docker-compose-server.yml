# ============================================================================
# UDP-Speeder-Manager Docker Compose - Server Configuration
# ============================================================================
# Project: UDP-Speeder-Manager
# Author: iHub-2020
# Version: v2.0.0
# Date: 2026-01-17
# Description: Server mode configuration with host networking
# Repository: https://github.com/iHub-2020/UDP-Speeder-Manager
# ============================================================================

version: '3.8'

services:
  speeder-server:
    image: ghcr.io/ihub-2020/udp-speeder-manager:latest
    container_name: udp-speeder-server
    restart: unless-stopped
    network_mode: host
    
    environment:
      # ========== Basic Configuration ==========
      - MODE=${MODE:-server}
      - LOCAL_ADDR=${LOCAL_ADDR:-0.0.0.0}
      - LOCAL_PORT=${LOCAL_PORT:-29900}
      - REMOTE_ADDR=${REMOTE_ADDR:-127.0.0.1}
      - REMOTE_PORT=${REMOTE_PORT:-7777}
      - FEC_PARAMS=${FEC_PARAMS:-20:10}
      - PASSWORD=${PASSWORD:-passwd}
      - WORK_MODE=${WORK_MODE:-0}
      - TIMEOUT=${TIMEOUT:-8}
      
      # ========== Advanced Configuration (Optional) ==========
      # Uncomment and set if needed
      # - MTU=${MTU}
      # - QUEUE_LEN=${QUEUE_LEN}
      # - INTERVAL=${INTERVAL}
      # - JITTER=${JITTER}
      # - REPORT=${REPORT}
      # - DISABLE_OBSCURE=${DISABLE_OBSCURE}
      # - EXTRA_ARGS=${EXTRA_ARGS}
      
      # ========== System Configuration ==========
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - TZ=${TZ:-Asia/Shanghai}
    
    volumes:
      - ${CONFIG_DIR:-/opt/udp-speeder/config}:/app/config
      - ${LOG_DIR:-/opt/udp-speeder/logs}:/app/logs
    
    healthcheck:
      test: ["CMD", "/entrypoint.sh", "health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
    
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
